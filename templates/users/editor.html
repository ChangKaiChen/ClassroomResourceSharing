{% extends 'base.html' %}
{% block title %}{{ title }}{% endblock title %}
{% block styles %}
<link rel="stylesheet"
      href="{{ url_for('static', filename='assets/css/wangeditor.css') }}"/> <!--https://www.jsdelivr.com/  CDN下载的-->
<style>
    #editor—wrapper {
        border: 1px solid #ccc;
        z-index: 100; /* 按需定义 */
    }

    #toolbar-container {
        border-bottom: 1px solid #ccc;
    }

    #editor-container {
        height: 600px;
    }
</style>
{% endblock styles %}
{% block content %}
<ol class="breadcrumb mb-3">

</ol>
<div class="row mx-0">
    <div class="col-12 col-md-9 px-0" style="width: 100%">
        <div class="left_content">
            <div class="card message_card">
                <div class="mb-0">
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="article-title" class="form-label">资源标题</label>
                            <input type="text" class="form-control" id="article-title" placeholder="请输入资源标题"
                                   required>
                        </div>
                        <div class="mb-4">
                            <label for="article-type" class="form-label">资源类型</label>
                            <input type="text" class="form-control" id="article-type" placeholder="请输入资源类型"
                                   required>
                        </div>
                        <div class="mb-4">
                            <label for="file-upload" class="form-label">资源文件（仅支持压缩包）</label>
                            <input type="file" class="form-control" id="file-upload" accept=".zip,.rar,.7z">
                        </div>
                        <!--                        <hr aria-hidden="true">-->
                        <div class="message" isfirst="1">
                            <div id="editor—wrapper">
                                <div id="toolbar-container"><!-- 工具栏 --></div>
                                <div id="editor-container"><!-- 编辑器 --></div>
                            </div>
                        </div>
                        <div class="mt-4 text-center">
                            <button type="button" style="width: 30%;margin-bottom: 10px;" class="btn btn-primary btn-lg"
                                    onclick="finishEditing()">发布
                            </button>
                        </div>
                        <div style="height: 33px; line-height: 33px; border-top: 1px solid #ddd;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
{% block scripts %}
<script src="/static/assets/js/wangeditor.js"></script>
<script>
    const {createEditor, createToolbar} = window.wangEditor
    const editorConfig = {
        placeholder: 'Type here...',
        // onChange(editor) {
        //     const html = editor.getHtml()
        //     // console.log('editor content', html)
        //     // 也可以同步到 <textarea>
        // }
    }

    const editor = createEditor({
        selector: '#editor-container',
        html: '<p><br></p>',
        config: editorConfig,
        mode: 'default', // or 'simple'
    })

    const toolbarConfig = {}

    const toolbar = createToolbar({
        editor,
        selector: '#toolbar-container',
        config: toolbarConfig,
        mode: 'default', // or 'simple'
    })

    function finishEditing() {
        let title = document.getElementById("article-title").value;
        let category = document.getElementById("article-type").value;
        let html = editor.getHtml();
        let file = document.getElementById("file-upload").files[0];
        let formData = new FormData();
        formData.append("title", title);
        formData.append("html", html);
        formData.append("category", category);
        formData.append("file", file);
        if (title !== '' && category !== '' && html !== '') {
            $.ajax({
                url: '/editor',
                data: formData,
                contentType: false, // 必须为 false，以避免 jQuery 设置错误的内容类型
                processData: false, // 必须为 false，以防止 jQuery 将 FormData 转换为字符串
                type: 'POST',
                success: function (response) {
                    alert(response.msg)
                    if (response.success) {
                        window.location.href = "/resources";
                    }
                },
                error: function () {
                    alert("请求失败！")
                }
            })
        } else {
            alert("请填写完整内容！")
        }
    }
</script>
{% endblock scripts %}